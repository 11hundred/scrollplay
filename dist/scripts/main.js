function setTimeline(e){$(".track-title").html(e.user.username+' &mdash; "'+e.title+'"'),$(".comments-list").css("height",Math.round(e.duration*magnitude)),$(".comments-list .comment").remove(),$.get(host+"/tracks/"+e.id+"/comments?consumer_key="+consumerKey,function(e){e.sort(function(e,t){return parseFloat(e.timestamp)-parseFloat(t.timestamp)});for(var t,a=0,s=0;s<e.length;s++){var o=Math.round(e[s].timestamp*magnitude);a+t>o&&(o=a+t);var r=e[s].user.avatar_url;r=r.replace("-large.jpg","-badge.jpg"),$(".comments-list").append('<div id="comment-'+e[s].id+'" class="comment" style="top: '+o+'px;"><img class="avatar" src="'+r+'"><span class="comment-text">'+e[s].user.username+": "+e[s].body+"</span></div>"),t=$(".comments-list .comment").last().outerHeight(),a=o}})}function updateProgress(e){var t;t=e>=0?e:track.position;var a=t/track.durationEstimate;$(".bar-progress").css("width",100*a+"%"),$(".comments-progress").css("top",Math.round(a*$(window).height())+"px"),container.animate({scrollTop:a*$(".comments-list").outerHeight()},0)}function setPosition(e){track.setPosition(e),updateProgress(e)}function setArtwork(e){if(e.artwork_url){var t=e.artwork_url;t=t.replace("-large.jpg","-t500x500.jpg"),$(".image-bg-wrap").css("background-image","url("+t+")")}}function loadTrack(e,t){track&&track.destruct(),SC.initialize({client_id:consumerKey}),$(".search-wrap").toggleClass("hide"),$(".status-control").addClass("playing"),$(".track-title, .comments-list").html(),playingElements.removeClass("hide"),SC.whenStreamingReady(function(){track=SC.stream("/tracks/"+e,{autoPlay:!1},function(a){$.get(host+"/tracks/"+e+"?consumer_key="+consumerKey,function(e){$("body").addClass("trackloaded"),t||history.pushState("","New ID: "+e.id,"/#/"+e.id+"/"+e.permalink),document.title=e.title+" | ScrollPlay",setArtwork(e),setTimeline(e),a.play({whileplaying:function(){updateProgress()},onfinish:function(){$(".status-control").toggleClass("playing")}}),$(".header-top-row").removeClass("collapsed")}).fail(function(){playingElements.addClass("hide"),$(".search-toggle").trigger("click"),$(".search-results").addClass("filled").html("Track not found. Search again.")})})})}function loadTrackFromURL(e,t){var a=new RegExp("(#)/([0-9]+)");return a.exec(e)?(loadTrack(a.exec(e)[2],t),!0):!1}var consumerKey="9994e3c432c77379bee441c98b1a4082",host="https://api.soundcloud.com",magnitude=.1,container=$(".wrapper"),track,SC,playingElements=$(".progress-bar, .controls, .comments-progress");$(document).ready(function(){window.location.hash&&loadTrackFromURL(window.location.hash),$(".status-control").click(function(){track.position>=track.duration?loadTrack():track.togglePause(),$(this).toggleClass("playing")}),$(".comments-toggle").click(function(){$("body").toggleClass("comments-shown")}),$(".progress-bar").click(function(e){setPosition(e.pageX/$(window).width()*track.durationEstimate)}),$(".search-toggle").click(function(){$(".search-wrap").toggleClass("hide"),$("#search-input").focus()}),$("#search-input").bind("propertychange change click keyup input paste",function(){var e=$(this).val();0===e.length?($(".search-results").html(""),$(".search-results").removeClass("filled")):e.length>2&&SC.get("/tracks?consumer_key="+consumerKey,{q:e},function(e){var t="";if(e.length<=1)t="No tracks found.";else for(var a=0;5>a&&(e[a].streamable===!0&&(t+='<div class="search-track" data-trackid="'+e[a].id+'">',e[a].artwork_url&&(t+='<img src="'+e[a].artwork_url+'">'),t+='<div class="meta"><div class="meta-title">'+e[a].title+'</div><div class="meta-artist">by '+e[a].user.username+"</div></div></div>"),a!=e.length-1);a++);$(".search-results").addClass("filled"),$(".search-results").html(t).promise().done(function(){$(".search-track").click(function(){loadTrack($(this).data("trackid"))})})})}),$.fn.drags=function(e){e=$.extend({handle:"",cursor:"move"},e);var t;return t=""===e.handle?this:this.find(e.handle),t.css("cursor",e.cursor).on("mousedown",function(t){var a;a=""===e.handle?$(this).addClass("draggable"):$(this).addClass("active-handle").parent().addClass("draggable");var s=a.css("z-index"),o=a.outerHeight(),r=a.outerWidth(),n=a.offset().top+o-t.pageY,i=a.offset().left+r-t.pageX;a.css("z-index",1e3).parents().on("mousemove",function(e){{var t,c,l=$(window).width();$(window).height()}t=e.pageX+i>l?l-r:a.position().left<0?0:e.pageX+i-r,c=a.position().top<0?0:e.pageY+n-o,$(".draggable").offset({top:c,left:t}).on("mouseup",function(){$(this).removeClass("draggable").css("z-index",s)})}),t.preventDefault()}).on("mouseup",function(){""===e.handle?$(this).removeClass("draggable"):$(this).removeClass("active-handle").parent().removeClass("draggable")})},$("header").drags()}),$(window).on("popstate",function(){loadTrackFromURL(window.location.hash,!0),$(".search-wrap").addClass("hide")}),$("body").on("DOMMouseScroll mousewheel",function(e){return $("body").hasClass("trackloaded")&&setPosition(e.originalEvent.detail>0||e.originalEvent.wheelDelta<0?track.position+100:track.position-100),!1});
//# sourceMappingURL=main.js.map