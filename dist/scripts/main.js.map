{"version":3,"sources":["main.js"],"names":["setTimeline","data","lastFMArtistSearch","user","username","$","html","title","css","Math","round","duration","magnitude","remove","get","host","id","consumerKey","sort","a","b","parseFloat","timestamp","lastHeight","lastCommentTop","i","length","thisTop","userAvatar","avatar_url","replace","append","body","last","outerHeight","updateProgress","givenposition","newposition","track","position","percentComplete","durationEstimate","window","height","container","animate","scrollTop","setPosition","setArtwork","artwork_url","tempArtwork","loadTrack","trackID","isHistory","destruct","SC","initialize","client_id","toggleClass","addClass","playingElements","removeClass","whenStreamingReady","stream","autoPlay","history","pushState","permalink","document","play","whileplaying","onfinish","fail","trigger","loadTrackFromURL","url","regexTrack","RegExp","exec","ajax","dataType","lastFMAPIKey","done","getArtistEvents","results","artistmatches","artist","name","lastFMArtistName","encodeURI","events","event","tempItems","venue","location","city","country","startDate","empty","find","ready","hash","click","togglePause","this","e","pageX","width","focus","bind","searchQuery","val","q","tracks","searchResultsHTML","streamable","promise","fn","drags","opt","extend","handle","cursor","$el","on","$drag","parent","z_idx","drg_h","drg_w","outerWidth","pos_y","offset","top","pageY","pos_x","left","parents","finalX","finalY","windowWidth","preventDefault","hasClass","originalEvent","detail","wheelDelta"],"mappings":"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","file":"main.js","sourcesContent":["var consumerKey = '9994e3c432c77379bee441c98b1a4082';\nvar lastFMAPIKey = '70eb62503565b422507f84fbf689cb18';\nvar host = 'https://api.soundcloud.com';\nvar magnitude = 0.10;\nvar container = $('.wrapper');\nvar track, SC;\nvar playingElements = $('.progress-bar, .controls, .comments-progress');\n\nfunction setTimeline(data) {\n  lastFMArtistSearch(data.user.username);\n  $('.track-title').html(data.user.username + ' &mdash; \"' + data.title + '\"');\n  $('.comments-list').css('height', Math.round(data.duration * magnitude));\n  $('.comments-list .comment').remove();\n  $.get(host + '/tracks/' + data.id + '/comments?consumer_key=' + consumerKey, function(data) {\n    data.sort(function(a,b) { return parseFloat(a.timestamp) - parseFloat(b.timestamp); } );\n    var lastCommentTop = 0;\n    var lastHeight;\n    for (var i = 0; i < data.length; i++) {\n      var thisTop = Math.round(data[i].timestamp * magnitude);\n      if (thisTop < lastCommentTop + lastHeight) {\n        thisTop = lastCommentTop + lastHeight;\n      }\n      var userAvatar = data[i].user.avatar_url;\n      userAvatar = userAvatar.replace('-large.jpg', '-badge.jpg');\n      $('.comments-list').append('<div id=\"comment-' + data[i].id + '\" class=\"comment\" style=\"top: ' + thisTop + 'px;\"><img class=\"avatar\" src=\"' + userAvatar + '\"><span class=\"comment-text\">' + data[i].user.username + ': ' + data[i].body + '</span></div>');\n      lastHeight = $('.comments-list .comment').last().outerHeight();\n      lastCommentTop = thisTop;\n    }\n  });\n}\n\nfunction updateProgress(givenposition) {\n  var newposition;\n  if (givenposition >= 0) {\n    newposition = givenposition;\n  } else {\n    newposition = track.position;\n  }\n\n  var percentComplete = newposition / track.durationEstimate;\n\n  $('.bar-progress').css('width', percentComplete * 100 + '%');\n  $('.comments-progress').css('top', Math.round(percentComplete * $(window).height()) + 'px');\n\n  container.animate({\n    scrollTop: percentComplete * $('.comments-list').outerHeight()\n  }, 0);\n}\n\nfunction setPosition(newposition) {\n  track.setPosition(newposition);\n  updateProgress(newposition);\n}\n\nfunction setArtwork(data) {\n  if (data.artwork_url) {\n    var tempArtwork = data.artwork_url;\n    tempArtwork = tempArtwork.replace('-large.jpg', '-t500x500.jpg');\n    $('.image-bg-wrap').css('background-image', 'url(' + tempArtwork + ')');\n  }\n}\n\nfunction loadTrack(trackID, isHistory) {\n\n  if (track) {\n    track.destruct();\n  }\n\n  SC.initialize({\n    client_id: consumerKey\n  });\n\n  $('.search-wrap').toggleClass('hide');\n  $('.status-control').addClass('playing');\n\n  $('.track-title, .comments-list').html();\n  playingElements.removeClass('hide');\n\n  SC.whenStreamingReady(function() {\n    track = SC.stream('/tracks/' + trackID, {\n      autoPlay: false\n    }, function(track) {\n      $.get(host + '/tracks/' + trackID + '?consumer_key=' + consumerKey, function(data) {\n        $('body').addClass('trackloaded');\n        if (!isHistory) {\n          history.pushState('', 'New ID: ' + data.id, '/#/' + data.id + '/' + data.permalink);\n        }\n        document.title = data.title + ' | ScrollPlay';\n        setArtwork(data);\n        setTimeline(data);\n        track.play({\n          whileplaying: function() {\n            updateProgress();\n          },\n          onfinish: function() {\n            $('.status-control').toggleClass('playing');\n          }\n        });\n        $('.header-top-row').removeClass('collapsed');\n      }).fail(function() {\n        playingElements.addClass('hide');\n        $('.search-toggle').trigger('click');\n        $('.search-results').addClass('filled').html('Track not found. Search again.');\n      });\n    });\n  });\n}\n\nfunction loadTrackFromURL(url, isHistory) {\n  var regexTrack = new RegExp('(#)\\/([0-9]+)');\n  if (regexTrack.exec(url)) {\n    loadTrack(regexTrack.exec(url)[2], isHistory);\n    return true;\n  } else {\n    return false;\n  }\n}\n\nfunction lastFMArtistSearch(username) {\n  $.ajax({\n    dataType: 'json',\n    url: 'http://ws.audioscrobbler.com/2.0/?method=artist.search&api_key=' + lastFMAPIKey + '&format=json&limit=1&artist=' + username\n  }).done(function(data) {\n    getArtistEvents(data.results.artistmatches.artist.name);\n  });\n}\n\nfunction getArtistEvents(lastFMArtistName) {\n  $.ajax({\n    dataType: 'json',\n    url: 'http://ws.audioscrobbler.com/2.0/?method=artist.getevents&api_key=' + lastFMAPIKey + '&format=json&limit=3&autocorrect=1&artist=' + encodeURI(lastFMArtistName)\n  }).done(function(data) {\n    if (data.events.event && data.events.event.length > 0) {\n      $('.events-list').addClass('show');\n      var tempItems = '';\n      for (var i = 0; i < data.events.event.length; i++) {\n        tempItems += '<li>';\n          tempItems += '<a href=\"' + data.events.event[i].url + '\">';\n          tempItems += data.events.event[i].venue.location.city + ', ' + data.events.event[i].venue.location.country + ' - ' + data.events.event[i].startDate;\n          tempItems += '</a>';\n        tempItems += '</li>';\n      }\n      $('.events-list ul').empty().append(tempItems);\n    } else {\n      $('.events-list').removeClass('show').find('ul').empty();\n    }\n  });\n}\n\n$(document).ready(function() {\n\n  if (window.location.hash) {\n    loadTrackFromURL(window.location.hash);\n  }\n\n  $('.status-control').click(function() {\n    if (track.position >= track.duration) {\n      loadTrack();\n    } else {\n      track.togglePause();\n    }\n    $(this).toggleClass('playing');\n  });\n\n  $('.comments-toggle').click(function() {\n    $('body').toggleClass('comments-shown');\n  });\n\n  $('.progress-bar').click(function(e) {\n    setPosition((e.pageX / $(window).width()) * track.durationEstimate);\n  });\n\n  $('.search-toggle').click(function() {\n    $('.search-wrap').toggleClass('hide');\n    $('#search-input').focus();\n  });\n\n  $('#search-input').bind('propertychange change click keyup input paste', function() {\n    var searchQuery = $(this).val();\n    if (searchQuery.length === 0) {\n      $('.search-results').html('');\n      $('.search-results').removeClass('filled');\n    } else if (searchQuery.length > 2) {\n      SC.get('/tracks?consumer_key=' + consumerKey, { q: searchQuery }, function(tracks) {\n        var searchResultsHTML = '';\n        if (tracks.length <= 1) {\n          searchResultsHTML = 'No tracks found.';\n        } else {\n          for (var i = 0; i < 5; i++) {\n            if (tracks[i].streamable === true) {\n              searchResultsHTML += '<div class=\"search-track\" data-trackid=\"' + tracks[i].id + '\">';\n              if (tracks[i].artwork_url) {\n                searchResultsHTML += '<img src=\"' + tracks[i].artwork_url + '\">';\n              }\n              searchResultsHTML += '<div class=\"meta\"><div class=\"meta-title\">' + tracks[i].title + '</div><div class=\"meta-artist\">by ' + tracks[i].user.username + '</div></div></div>';\n            }\n            if (i == tracks.length - 1) {\n              break;\n            }\n          }\n        }\n        $('.search-results').addClass('filled');\n        $('.search-results').html(searchResultsHTML).promise().done(function() {\n          $('.search-track').click(function() {\n            loadTrack($(this).data('trackid'));\n          });\n        });\n      });\n    }\n  });\n\n  $.fn.drags = function(opt) {\n  \topt = $.extend({\n  \t\thandle: '',\n  \t\tcursor: 'move'\n  \t}, opt);\n\n    var $el;\n\n  \tif (opt.handle === '') {\n      $el = this;\n  \t} else {\n      $el = this.find(opt.handle);\n  \t}\n\n  \treturn $el.css('cursor', opt.cursor).on('mousedown', function(e) {\n      var $drag;\n  \t\tif (opt.handle === '') {\n        $drag = $(this).addClass('draggable');\n  \t\t} else {\n        $drag = $(this).addClass('active-handle').parent().addClass('draggable');\n  \t\t}\n  \t\tvar z_idx = $drag.css('z-index'),\n  \t\t\tdrg_h = $drag.outerHeight(),\n  \t\t\tdrg_w = $drag.outerWidth(),\n  \t\t\tpos_y = $drag.offset().top + drg_h - e.pageY,\n  \t\t\tpos_x = $drag.offset().left + drg_w - e.pageX;\n  \t\t$drag.css('z-index', 1000).parents().on('mousemove', function(e) {\n        var finalX;\n        var finalY;\n        var windowWidth = $(window).width();\n        var windowHeight = $(window).height();\n        if (e.pageX + pos_x > windowWidth) {\n          finalX = windowWidth - drg_w;\n        } else if ($drag.position().left < 0) {\n          finalX = 0;\n        } else {\n          finalX = e.pageX + pos_x - drg_w;\n        }\n        if ($drag.position().top < 0) {\n          finalY = 0;\n        } else {\n          finalY = e.pageY + pos_y - drg_h;\n        }\n  \t\t\t$('.draggable').offset({\n  \t\t\t\ttop: finalY,\n  \t\t\t\tleft: finalX\n  \t\t\t}).on('mouseup', function() {\n  \t\t\t\t$(this).removeClass('draggable').css('z-index', z_idx);\n  \t\t\t});\n  \t\t});\n  \t\te.preventDefault();\n  \t}).on('mouseup', function() {\n  \t\tif (opt.handle === '') {\n  \t\t\t$(this).removeClass('draggable');\n  \t\t} else {\n  \t\t\t$(this).removeClass('active-handle').parent().removeClass('draggable');\n  \t\t}\n  \t});\n\n  };\n\n  $('header').drags();\n\n});\n\n$(window).on('popstate', function(e) {\n  loadTrackFromURL(window.location.hash, true);\n  $('.search-wrap').addClass('hide');\n});\n\n$('body').on('DOMMouseScroll mousewheel', function(e) {\n  if ($('body').hasClass('trackloaded')) {\n    if (e.originalEvent.detail > 0 || e.originalEvent.wheelDelta < 0) {\n      setPosition(track.position + 100);\n    } else {\n      setPosition(track.position - 100);\n    }\n  }\n  return false;\n});\n"],"sourceRoot":"/source/"}