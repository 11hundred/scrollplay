{"version":3,"sources":["main.js"],"names":["setTimeline","data","$","html","user","username","title","css","Math","round","duration","magnitude","remove","get","host","id","consumerKey","sort","a","b","parseFloat","timestamp","lastHeight","lastCommentTop","i","length","thisTop","userAvatar","avatar_url","replace","append","body","last","outerHeight","updateProgress","givenposition","newposition","track","position","percentComplete","durationEstimate","window","height","container","animate","scrollTop","setPosition","setArtwork","artwork_url","tempArtwork","loadTrack","trackID","isHistory","destruct","SC","initialize","client_id","toggleClass","addClass","playingElements","removeClass","whenStreamingReady","stream","autoPlay","history","pushState","permalink","document","play","whileplaying","onfinish","fail","trigger","loadTrackFromURL","url","regexTrack","RegExp","exec","ready","location","hash","click","togglePause","this","e","pageX","width","focus","bind","searchQuery","val","q","tracks","searchResultsHTML","streamable","promise","done","fn","drags","opt","extend","handle","cursor","$el","find","on","$drag","parent","z_idx","drg_h","drg_w","outerWidth","pos_y","offset","top","pageY","pos_x","left","parents","finalX","finalY","windowWidth","preventDefault","hasClass","originalEvent","detail","wheelDelta"],"mappings":"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","file":"main.js","sourcesContent":["var consumerKey = '9994e3c432c77379bee441c98b1a4082';\nvar host = 'https://api.soundcloud.com';\nvar magnitude = 0.10;\nvar container = $('.wrapper');\nvar track, SC;\nvar playingElements = $('.progress-bar, .controls, .comments-progress');\n\nfunction setTimeline(data) {\n  $('.track-title').html(data.user.username + ' &mdash; \"' + data.title + '\"');\n  $('.comments-list').css('height', Math.round(data.duration * magnitude));\n  $('.comments-list .comment').remove();\n  $.get(host + '/tracks/' + data.id + '/comments?consumer_key=' + consumerKey, function(data) {\n    data.sort(function(a,b) { return parseFloat(a.timestamp) - parseFloat(b.timestamp); } );\n    var lastCommentTop = 0;\n    var lastHeight;\n    for (var i = 0; i < data.length; i++) {\n      var thisTop = Math.round(data[i].timestamp * magnitude);\n      if (thisTop < lastCommentTop + lastHeight) {\n        thisTop = lastCommentTop + lastHeight;\n      }\n      var userAvatar = data[i].user.avatar_url;\n      userAvatar = userAvatar.replace('-large.jpg', '-badge.jpg');\n      $('.comments-list').append('<div id=\"comment-' + data[i].id + '\" class=\"comment\" style=\"top: ' + thisTop + 'px;\"><img class=\"avatar\" src=\"' + userAvatar + '\"><span class=\"comment-text\">' + data[i].user.username + ': ' + data[i].body + '</span></div>');\n      lastHeight = $('.comments-list .comment').last().outerHeight();\n      lastCommentTop = thisTop;\n    }\n  });\n}\n\nfunction updateProgress(givenposition) {\n  var newposition;\n  if (givenposition >= 0) {\n    newposition = givenposition;\n  } else {\n    newposition = track.position;\n  }\n\n  var percentComplete = newposition / track.durationEstimate;\n\n  $('.bar-progress').css('width', percentComplete * 100 + '%');\n  $('.comments-progress').css('top', Math.round(percentComplete * $(window).height()) + 'px');\n\n  container.animate({\n    scrollTop: percentComplete * $('.comments-list').outerHeight()\n  }, 0);\n}\n\nfunction setPosition(newposition) {\n  track.setPosition(newposition);\n  updateProgress(newposition);\n}\n\nfunction setArtwork(data) {\n  if (data.artwork_url) {\n    var tempArtwork = data.artwork_url;\n    tempArtwork = tempArtwork.replace('-large.jpg', '-t500x500.jpg');\n    $('.image-bg-wrap').css('background-image', 'url(' + tempArtwork + ')');\n  }\n}\n\nfunction loadTrack(trackID, isHistory) {\n\n  if (track) {\n    track.destruct();\n  }\n\n  SC.initialize({\n    client_id: consumerKey\n  });\n\n  $('.search-wrap').toggleClass('hide');\n  $('.status-control').addClass('playing');\n\n  $('.track-title, .comments-list').html();\n  playingElements.removeClass('hide');\n\n  SC.whenStreamingReady(function() {\n    track = SC.stream('/tracks/' + trackID, {\n      autoPlay: false\n    }, function(track) {\n      $.get(host + '/tracks/' + trackID + '?consumer_key=' + consumerKey, function(data) {\n        $('body').addClass('trackloaded');\n        if (!isHistory) {\n          history.pushState('', 'New ID: ' + data.id, '/#/' + data.id + '/' + data.permalink);\n        }\n        document.title = data.title + ' | ScrollPlay';\n        setArtwork(data);\n        setTimeline(data);\n        track.play({\n          whileplaying: function() {\n            updateProgress();\n          },\n          onfinish: function() {\n            $('.status-control').toggleClass('playing');\n          }\n        });\n        $('.header-top-row').removeClass('collapsed');\n      }).fail(function() {\n        playingElements.addClass('hide');\n        $('.search-toggle').trigger('click');\n        $('.search-results').addClass('filled').html('Track not found. Search again.');\n      });\n    });\n  });\n}\n\nfunction loadTrackFromURL(url, isHistory) {\n  var regexTrack = new RegExp('(#)\\/([0-9]+)');\n  if (regexTrack.exec(url)) {\n    loadTrack(regexTrack.exec(url)[2], isHistory);\n    return true;\n  } else {\n    return false;\n  }\n}\n\n$(document).ready(function() {\n\n  if (window.location.hash) {\n    loadTrackFromURL(window.location.hash);\n  }\n\n  $('.status-control').click(function() {\n    if (track.position >= track.duration) {\n      loadTrack();\n    } else {\n      track.togglePause();\n    }\n    $(this).toggleClass('playing');\n  });\n\n  $('.comments-toggle').click(function() {\n    $('body').toggleClass('comments-shown');\n  });\n\n  $('.progress-bar').click(function(e) {\n    setPosition((e.pageX / $(window).width()) * track.durationEstimate);\n  });\n\n  $('.search-toggle').click(function() {\n    $('.search-wrap').toggleClass('hide');\n    $('#search-input').focus();\n  });\n\n  $('#search-input').bind('propertychange change click keyup input paste', function() {\n    var searchQuery = $(this).val();\n    if (searchQuery.length === 0) {\n      $('.search-results').html('');\n      $('.search-results').removeClass('filled');\n    } else if (searchQuery.length > 2) {\n      SC.get('/tracks?consumer_key=' + consumerKey, { q: searchQuery }, function(tracks) {\n        var searchResultsHTML = '';\n        if (tracks.length <= 1) {\n          searchResultsHTML = 'No tracks found.';\n        } else {\n          for (var i = 0; i < 5; i++) {\n            if (tracks[i].streamable === true) {\n              searchResultsHTML += '<div class=\"search-track\" data-trackid=\"' + tracks[i].id + '\">';\n              if (tracks[i].artwork_url) {\n                searchResultsHTML += '<img src=\"' + tracks[i].artwork_url + '\">';\n              }\n              searchResultsHTML += '<div class=\"meta\"><div class=\"meta-title\">' + tracks[i].title + '</div><div class=\"meta-artist\">by ' + tracks[i].user.username + '</div></div></div>';\n            }\n            if (i == tracks.length - 1) {\n              break;\n            }\n          }\n        }\n        $('.search-results').addClass('filled');\n        $('.search-results').html(searchResultsHTML).promise().done(function() {\n          $('.search-track').click(function() {\n            loadTrack($(this).data('trackid'));\n          });\n        });\n      });\n    }\n  });\n\n  $.fn.drags = function(opt) {\n  \topt = $.extend({\n  \t\thandle: '',\n  \t\tcursor: 'move'\n  \t}, opt);\n\n    var $el;\n\n  \tif (opt.handle === '') {\n      $el = this;\n  \t} else {\n      $el = this.find(opt.handle);\n  \t}\n\n  \treturn $el.css('cursor', opt.cursor).on('mousedown', function(e) {\n      var $drag;\n  \t\tif (opt.handle === '') {\n        $drag = $(this).addClass('draggable');\n  \t\t} else {\n        $drag = $(this).addClass('active-handle').parent().addClass('draggable');\n  \t\t}\n  \t\tvar z_idx = $drag.css('z-index'),\n  \t\t\tdrg_h = $drag.outerHeight(),\n  \t\t\tdrg_w = $drag.outerWidth(),\n  \t\t\tpos_y = $drag.offset().top + drg_h - e.pageY,\n  \t\t\tpos_x = $drag.offset().left + drg_w - e.pageX;\n  \t\t$drag.css('z-index', 1000).parents().on('mousemove', function(e) {\n        var finalX;\n        var finalY;\n        var windowWidth = $(window).width();\n        var windowHeight = $(window).height();\n        if (e.pageX + pos_x > windowWidth) {\n          finalX = windowWidth - drg_w;\n        } else if ($drag.position().left < 0) {\n          finalX = 0;\n        } else {\n          finalX = e.pageX + pos_x - drg_w;\n        }\n        if ($drag.position().top < 0) {\n          finalY = 0;\n        } else {\n          finalY = e.pageY + pos_y - drg_h;\n        }\n  \t\t\t$('.draggable').offset({\n  \t\t\t\ttop: finalY,\n  \t\t\t\tleft: finalX\n  \t\t\t}).on('mouseup', function() {\n  \t\t\t\t$(this).removeClass('draggable').css('z-index', z_idx);\n  \t\t\t});\n  \t\t});\n  \t\te.preventDefault();\n  \t}).on('mouseup', function() {\n  \t\tif (opt.handle === '') {\n  \t\t\t$(this).removeClass('draggable');\n  \t\t} else {\n  \t\t\t$(this).removeClass('active-handle').parent().removeClass('draggable');\n  \t\t}\n  \t});\n\n  };\n\n  $('header').drags();\n\n});\n\n$(window).on('popstate', function(e) {\n  loadTrackFromURL(window.location.hash, true);\n  $('.search-wrap').addClass('hide');\n});\n\n$('body').on('DOMMouseScroll mousewheel', function(e) {\n  if ($('body').hasClass('trackloaded')) {\n    if (e.originalEvent.detail > 0 || e.originalEvent.wheelDelta < 0) {\n      setPosition(track.position + 100);\n    } else {\n      setPosition(track.position - 100);\n    }\n  }\n  return false;\n});\n"],"sourceRoot":"/source/"}